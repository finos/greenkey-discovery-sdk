---
version: '3.6'

services:
    discovery:
        image: docker.greenkeytech.com/discovery:${DISCOVERY_TAG}
        ports:
            - ${DISCOVERY_PORT}:${DISCOVERY_PORT}
        environment:
            - LICENSE_KEY=${LICENSE_KEY}
            - PORT=${DISCOVERY_PORT}
            - NUMBER_OF_INTENTS=1
            - MAX_NUMBER_OF_ENTITIES=100
            - USE_CUSTOM_JSON_SCHEMA=True
            # This parameter suppresses default output from Discovery in favor of the custom schema.
            # Available options are the following:
            # True (removes everything not in an intent's JSON schema),
            # Most (removes extra keys generated by discovery under 'intents'),
            # and False, which removes nothing.
            # In production, this is set to `Most` by default to reduce payload size.
            - SUPPRESS_DEFAULT_OUTPUT=False
            # Primarily togglable here so we can disable these during CI testing for speed
            - USE_BUILT_IN_INTERPRETERS=${USE_BUILT_IN_INTERPRETERS:-True}
            # options for log levels, in decreasing log verbosity: debug, info, warning, error, critical
            - LOG_LEVEL=debug
            # Prune output lattice (remove word_confusions and alternates)
            - PRUNE_LATTICE=True
            - TOKENIZATION_STRATEGY=${TOKENIZATION_STRATEGY}
        volumes:
          - custom-discovery-interpreter:/custom
          - builtin-discovery-models:/sdk

volumes:
  custom-discovery-interpreter:
    external: true
  builtin-discovery-models:
    external: true